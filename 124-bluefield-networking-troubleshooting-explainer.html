<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>124. BlueField Networking Troubleshooting: Diagnosing DPU Network Issues</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
    --primary-color: #00695C;
    --secondary-color: #00796B;
    --accent-color: #00897B;
    --bg-color: #E0F2F1;
    --card-bg: #FFFFFF;
    --text-color: #1A1A1A;
    --border-color: #80CBC4;
    --shadow: 0 2px 8px rgba(0, 105, 92, 0.1);
}
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    line-height: 1.6;
}
header {
    text-align: center;
    padding: 50px 40px;
    background: linear-gradient(135deg, #00695C, #00796B);
    color: white;
    position: relative;
}
header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 12px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}
.subtitle {
    font-size: 1.2rem;
    opacity: 0.95;
    font-weight: 300;
}
.author-credit {
    font-size: 1rem;
    font-weight: 600;
    margin-top: 15px;
    padding: 8px 20px;
    background: rgba(255, 255, 255, 0.25);
    border-radius: 6px;
    display: inline-block;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    border: 2px solid rgba(255, 255, 255, 0.4);
}

.sidebar-wrapper {
    display: flex;
    min-height: calc(100vh - 200px);
}
.nav-menu {
    width: 280px;
    min-width: 280px;
    background: #80DEEA;
    border-right: 2px solid var(--border-color);
    padding: 20px 0;
    position: sticky;
    top: 0;
    height: calc(100vh - 200px);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.nav-link {
    color: var(--text-color);
    text-decoration: none;
    padding: 12px 20px;
    margin: 0 10px;
    border-radius: 6px;
    transition: all 0.2s ease;
    font-weight: 500;
    display: block;
}
.nav-link:hover, .nav-link.active {
    background: var(--primary-color);
    color: white;
}
.main-content-wrapper {
    flex: 1;
    width: calc(100% - 280px);
    min-width: 0;
}

.section {
    padding: 40px;
    min-height: calc(100vh - 200px);
    border-bottom: 1px solid var(--border-color);
    max-width: 100%;
}
.section h2 {
    font-size: 2.2rem;
    margin-bottom: 20px;
    color: var(--primary-color);
    border-bottom: 3px solid var(--primary-color);
    padding-bottom: 10px;
}
.section h3 {
    font-size: 1.6rem;
    margin: 25px 0 15px;
    color: var(--secondary-color);
}
.section p {
    margin-bottom: 18px;
    font-size: 1.05rem;
    line-height: 1.8;
}
.troubleshooting-card {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 12px;
    border-left: 5px solid var(--primary-color);
    margin: 20px 0;
    box-shadow: var(--shadow);
}
.troubleshooting-card h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.4rem;
}
.concept-card {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 12px;
    border: 2px solid var(--border-color);
    margin: 20px 0;
    box-shadow: var(--shadow);
}
.concept-card h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.4rem;
}
.mermaid { margin: 30px 0; text-align: center; }
.example-box {
    background: linear-gradient(135deg, #E0F2F1, #80CBC4);
    border-left: 5px solid var(--primary-color);
    padding: 20px 25px;
    margin: 20px 0;
    border-radius: 8px;
}
.example-box strong {
    color: var(--primary-color);
    display: block;
    margin-bottom: 10px;
    font-size: 1.1rem;
}
code {
    background: #F5F5F5;
    padding: 2px 8px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    color: #D32F2F;
}
.command-box {
    background: #263238;
    color: #00897B;
    padding: 20px;
    border-radius: 8px;
    margin: 15px 0;
    font-family: 'Courier New', monospace;
    overflow-x: auto;
}
footer {
    text-align: center;
    padding: 40px;
    background: #80CBC4;
    border-top: 2px solid var(--border-color);
    color: var(--text-color);
}
@media (max-width: 768px) {
    header h1 { font-size: 2rem; }
    
    .nav-menu {
        width: 100%;
        min-width: 100%;
        height: auto;
        position: relative;
        flex-direction: row;
        flex-wrap: wrap;
        padding: 10px;
        border-right: none;
        border-bottom: 2px solid var(--border-color);
    }
    .nav-link {
        padding: 8px 15px;
        margin: 4px;
    }
    
    .section { padding: 25px 20px; }
}
    .section {
    padding: 40px;
    min-height: calc(100vh - 200px);
    border-bottom: 1px solid var(--border-color);
    max-width: 100%;
}
    </style>
</head>
<body>
    <header>
        <h1>124. BlueField Networking Troubleshooting</h1>
        <p class="subtitle">Diagnosing and Resolving DPU Network Issues</p>
        <p class="author-credit">Explained by Naman Adep</p>
    </header>

    <div class="sidebar-wrapper">
    <nav class="nav-menu">
        <a href="#overview" class="nav-link active">Overview</a>
        <a href="#methodology" class="nav-link">Methodology</a>
        <a href="#interface-issues" class="nav-link">Interface Issues</a>
        <a href="#ovs-troubleshooting" class="nav-link">OVS Troubleshooting</a>
        <a href="#doca-debugging" class="nav-link">DOCA Debugging</a>
        <a href="#connectivity" class="nav-link">Connectivity</a>
        <a href="#best-practices" class="nav-link">Best Practices</a>
    </nav>
    <div class="main-content-wrapper">
        <main>
        <section id="overview" class="section">
            <h2>BlueField Networking Troubleshooting Overview</h2>
            <p>
                BlueField DPU networking troubleshooting involves diagnosing and resolving network issues specific to 
                DPU functionality. DPU networking issues can affect host-DPU communication, network interfaces, OVS 
                bridges, and DOCA applications. Systematic troubleshooting ensures rapid problem resolution and 
                maintains network functionality. Understanding DPU-specific troubleshooting enables efficient resolution 
                of networking issues.
            </p>

            <div class="mermaid">
                graph TD
                    A[DPU Network Issue] --> B[Gather Information]
                    B --> C[Identify Component]
                    C --> D{Issue Type?}
                    D -->|Interface| E[Network Interface]
                    D -->|OVS| F[OVS Bridge]
                    D -->|DOCA| G[DOCA Application]
                    D -->|Connectivity| H[Host-DPU Communication]
                    E --> I[Isolate Problem]
                    F --> I
                    G --> I
                    H --> I
                    I --> J[Test Hypothesis]
                    J --> K[Implement Solution]
                    K --> L[Verify Resolution]
                    
                    style A fill:#00695C
                    style L fill:#4CAF50
                    style D fill:#FF9800
            </div>

            <div class="example-box">
                <strong>Troubleshooting Impact:</strong>
                Effective DPU networking troubleshooting reduces network downtime, ensures reliable DPU functionality, 
                and maintains optimal network performance. Systematic troubleshooting prevents misdiagnosis and enables 
                rapid problem resolution.
            </div>

            <div class="mermaid">
                mindmap
                  root((DPU Network Troubleshooting))
                    Methodology
                      Information Gathering
                      Problem Isolation
                      Component Analysis
                    Network Interfaces
                      PF Issues
                      VF Issues
                      SF Issues
                    OVS Troubleshooting
                      Bridge Issues
                      Port Issues
                      Flow Issues
                    DOCA Debugging
                      Application Issues
                      Runtime Errors
                      Performance Problems
            </div>
        </section>

        <section id="methodology" class="section">
            <h2>Troubleshooting Methodology</h2>
            <p>
                Follow a systematic methodology for DPU networking troubleshooting, similar to general network 
                troubleshooting but focused on DPU-specific components.
            </p>

            <div class="mermaid">
                flowchart TD
                    A[DPU Network Issue] --> B[Gather Information]
                    B --> C[Symptoms]
                    B --> D[Scope]
                    B --> E[Error Messages]
                    C --> F[Identify Component]
                    D --> F
                    E --> F
                    F --> G{Component Type?}
                    G -->|Network Interface| H[Check Interface Status]
                    G -->|OVS| I[Check OVS Status]
                    G -->|DOCA| J[Check DOCA Status]
                    G -->|Host-DPU| K[Check Communication]
                    H --> L[Isolate Problem]
                    I --> L
                    J --> L
                    K --> L
                    L --> M[Test Hypothesis]
                    M --> N{Issue Resolved?}
                    N -->|No| F
                    N -->|Yes| O[Document Solution]
                    
                    style A fill:#00695C
                    style O fill:#4CAF50
                    style G fill:#FF9800
                    style N fill:#FF9800
                </div>

            <div class="concept-card">
                <h3>Step 1: Information Gathering</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Symptoms:</strong> What is the observed problem? (No connectivity, slow performance, interface down)</li>
                    <li><strong>Scope:</strong> Is the issue affecting one interface, multiple interfaces, or entire DPU?</li>
                    <li><strong>Timeline:</strong> When did the issue start?</li>
                    <li><strong>Context:</strong> What changed recently? (Configuration, firmware, software updates)</li>
                    <li><strong>Error Messages:</strong> Collect all error messages and logs</li>
                </ul>
            </div>

            <div class="concept-card">
                <h3>Step 2: Component Analysis</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Network Interfaces:</strong> Check PF, VF, SF status</li>
                    <li><strong>OVS Bridges:</strong> Check bridge and port status</li>
                    <li><strong>DOCA Applications:</strong> Check application status and logs</li>
                    <li><strong>Host-DPU Communication:</strong> Check RShim and management interfaces</li>
                </ul>
            </div>
        </section>

        <section id="interface-issues" class="section">
            <h2>Network Interface Issues</h2>
            <p>
                Troubleshoot DPU network interface issues including PF, VF, and SF problems. Interface issues can 
                prevent network connectivity and affect DPU functionality.
            </p>

            <div class="troubleshooting-card">
                <h3>Issue: Interface Not Detected</h3>
                <p><strong>Symptoms:</strong> Network interface not visible, no connectivity</p>
                
                <p style="margin-top: 15px;"><strong>Troubleshooting Steps:</strong></p>
                <ol style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li>Check DPU firmware status</li>
                    <li>Verify DPU is detected by host</li>
                    <li>Check interface configuration</li>
                    <li>Review system logs</li>
                    <li>Verify driver is loaded</li>
                </ol>

                <p style="margin-top: 20px;"><strong>Check DPU Status:</strong></p>
                <div class="command-box">
# Check DPU detection
lspci | grep -i mellanox

# Check DPU firmware
mlxfwmanager

# Check interface status
ip link show
ip addr show

# Check driver status
lsmod | grep mlx5
                </div>
            </div>

            <div class="troubleshooting-card">
                <h3>Issue: Interface Down</h3>
                <p><strong>Symptoms:</strong> Interface exists but is down, no link</p>
                
                <p style="margin-top: 15px;"><strong>Troubleshooting Steps:</strong></p>
                <ol style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li>Check physical cable connection</li>
                    <li>Verify interface is enabled</li>
                    <li>Check link status</li>
                    <li>Review interface configuration</li>
                    <li>Check for errors</li>
                </ol>

                <p style="margin-top: 20px;"><strong>Check Interface Status:</strong></p>
                <div class="command-box">
# Check interface status
ip link show [interface]

# Bring interface up
ip link set [interface] up

# Check link status
ethtool [interface]

# Check for errors
ethtool -S [interface] | grep -i error
                </div>
            </div>

            <div class="troubleshooting-card">
                <h3>Issue: VF/SF Not Created</h3>
                <p><strong>Symptoms:</strong> Cannot create VF or SF, creation fails</p>
                
                <p style="margin-top: 15px;"><strong>Troubleshooting Steps:</strong></p>
                <ol style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li>Check PF status</li>
                    <li>Verify SR-IOV is enabled</li>
                    <li>Check available VF/SF capacity</li>
                    <li>Review configuration</li>
                    <li>Check system resources</li>
                </ol>

                <p style="margin-top: 20px;"><strong>Check VF/SF Status:</strong></p>
                <div class="command-box">
# Check SR-IOV status
cat /sys/class/net/[pf]/device/sriov_numvfs

# Check VF count
ip link show [pf] | grep vf

# Check SF status (on DPU)
mlxconfig -d [device] query | grep SF
                </div>
            </div>
        </section>

        <section id="ovs-troubleshooting" class="section">
            <h2>OVS Troubleshooting</h2>
            <p>
                Troubleshoot OVS (Open vSwitch) bridge and port issues on BlueField DPU. OVS issues can affect 
                network virtualization and traffic forwarding.
            </p>

            <div class="troubleshooting-card">
                <h3>Issue: OVS Bridge Not Working</h3>
                <p><strong>Symptoms:</strong> OVS bridge exists but traffic not forwarding</p>
                
                <p style="margin-top: 15px;"><strong>Troubleshooting Steps:</strong></p>
                <ol style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li>Check OVS service status</li>
                    <li>Verify bridge exists</li>
                    <li>Check port status</li>
                    <li>Review flow rules</li>
                    <li>Check OVS logs</li>
                </ol>

                <p style="margin-top: 20px;"><strong>Check OVS Status:</strong></p>
                <div class="command-box">
# Check OVS service
systemctl status openvswitch

# List bridges
ovs-vsctl show

# List ports
ovs-vsctl list-ports [bridge]

# Check flows
ovs-ofctl dump-flows [bridge]

# Check OVS logs
journalctl -u openvswitch -f
                </div>
            </div>

            <div class="troubleshooting-card">
                <h3>Issue: Port Not Added to Bridge</h3>
                <p><strong>Symptoms:</strong> Cannot add port to OVS bridge</p>
                
                <p style="margin-top: 15px;"><strong>Troubleshooting Steps:</strong></p>
                <ol style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li>Verify interface exists</li>
                    <li>Check interface is not already in use</li>
                    <li>Verify bridge exists</li>
                    <li>Check permissions</li>
                    <li>Review error messages</li>
                </ol>

                <p style="margin-top: 20px;"><strong>Add Port to Bridge:</strong></p>
                <div class="command-box">
# Add port to bridge
ovs-vsctl add-port [bridge] [interface]

# Check port status
ovs-vsctl show [bridge]

# Remove port if needed
ovs-vsctl del-port [bridge] [interface]
                </div>
            </div>
        </section>

        <section id="doca-debugging" class="section">
            <h2>DOCA Application Debugging</h2>
            <p>
                Debug DOCA (Data Center On-A-Chip Architecture) applications running on BlueField DPU. DOCA 
                debugging involves application logs, runtime errors, and performance issues.
            </p>

            <div class="concept-card">
                <h3>DOCA Application Logs</h3>
                <p>Check DOCA application logs for errors:</p>
                
                <p style="margin-top: 20px;"><strong>Check Application Logs:</strong></p>
                <div class="command-box">
# Check DOCA application logs
journalctl -u doca-app -f

# Check application output
# (application-specific log locations)

# Check system logs
dmesg | grep -i doca
journalctl -k | grep -i doca
                </div>
            </div>

            <div class="concept-card">
                <h3>DOCA Runtime Debugging</h3>
                <p>Debug DOCA application runtime issues:</p>
                
                <p style="margin-top: 20px;"><strong>Debug Commands:</strong></p>
                <div class="command-box">
# Check DOCA service status
systemctl status doca

# Check DOCA version
doca_version

# Check DPU resources
# (DPU-specific commands)

# Monitor DOCA processes
ps aux | grep doca
top -p $(pgrep doca)
                </div>
            </div>
        </section>

        <section id="connectivity" class="section">
            <h2>Host-DPU Connectivity Issues</h2>
            <p>
                Troubleshoot connectivity issues between host and DPU. Host-DPU communication is critical for DPU 
                management and functionality.
            </p>

            <div class="troubleshooting-card">
                <h3>Issue: Cannot Access DPU</h3>
                <p><strong>Symptoms:</strong> Cannot communicate with DPU, management interface unreachable</p>
                
                <p style="margin-top: 15px;"><strong>Troubleshooting Steps:</strong></p>
                <ol style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li>Check RShim interface</li>
                    <li>Verify DPU is powered and initialized</li>
                    <li>Check network connectivity</li>
                    <li>Verify management IP configuration</li>
                    <li>Review DPU logs</li>
                </ol>

                <p style="margin-top: 20px;"><strong>Check RShim:</strong></p>
                <div class="command-box">
# Check RShim interface
ip link show rshim0

# Check RShim connectivity
ping [dpu_ip]

# Access DPU via RShim
ssh root@[dpu_ip]

# Check DPU status via RShim
rshim [device] console
                </div>
            </div>
        </section>

        <section id="best-practices" class="section">
            <h2>DPU Networking Troubleshooting Best Practices</h2>
            <p>
                Follow best practices for effective DPU networking troubleshooting.
            </p>

            <div class="concept-card">
                <h3>Troubleshooting Best Practices</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li>Gather comprehensive information before troubleshooting</li>
                    <li>Isolate the problem to specific component</li>
                    <li>Check DPU firmware and driver versions</li>
                    <li>Review DPU-specific logs</li>
                    <li>Test connectivity at each layer</li>
                    <li>Document troubleshooting steps and solutions</li>
                </ul>
            </div>

            <div class="example-box">
                <strong>DPU Networking Troubleshooting Checklist:</strong>
                1. Gather information about the issue<br>
                2. Identify affected component<br>
                3. Check DPU status and firmware<br>
                4. Verify network interface status<br>
                5. Check OVS bridge and port status<br>
                6. Review DOCA application logs<br>
                7. Test host-DPU connectivity<br>
                8. Isolate and test hypothesis<br>
                9. Implement solution<br>
                10. Verify resolution and document
            </div>
        </section>
            </main>

            </div>
</div>

    <footer>
        <p>BlueField Networking Troubleshooting | Diagnosing DPU Network Issues</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);
                
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' }
);
            });
        });

        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav-link');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (window.pageYOffset >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }

            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
