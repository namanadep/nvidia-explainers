<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>44. InfiniBand Subnet Manager: Network Navigator</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
    --primary-color: #1976D2;
    --secondary-color: #2196F3;
    --accent-color: #64B5F6;
    --bg-color: #E3F2FD;
    --card-bg: #FFFFFF;
    --text-color: #1A1A1A;
    --border-color: #90CAF9;
    --shadow: 0 2px 8px rgba(25, 118, 210, 0.1);
}
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    line-height: 1.6;
}
header {
    text-align: center;
    padding: 50px 40px;
    background: linear-gradient(135deg, #1976D2, #2196F3);
    color: white;
}
header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 12px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}
.subtitle {
    font-size: 1.2rem;
    opacity: 0.95;
    font-weight: 300;
}
.author-credit {
    font-size: 1rem;
    font-weight: 600;
    margin-top: 15px;
    padding: 8px 20px;
    background: rgba(255, 255, 255, 0.25);
    border-radius: 6px;
    display: inline-block;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    border: 2px solid rgba(255, 255, 255, 0.4);
}

.sidebar-wrapper {
    display: flex;
    min-height: calc(100vh - 200px);
}
.nav-menu {
    width: 280px;
    min-width: 280px;
    background: #80DEEA;
    border-right: 2px solid var(--border-color);
    padding: 20px 0;
    position: sticky;
    top: 0;
    height: calc(100vh - 200px);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.nav-link {
    color: var(--text-color);
    text-decoration: none;
    padding: 12px 20px;
    margin: 0 10px;
    border-radius: 6px;
    transition: all 0.2s ease;
    font-weight: 500;
    display: block;
}
.nav-link:hover, .nav-link.active {
    background: var(--primary-color);
    color: white;
}
.main-content-wrapper {
    flex: 1;
    width: calc(100% - 280px);
    min-width: 0;
}

.section {
    padding: 40px;
    min-height: calc(100vh - 200px);
    border-bottom: 1px solid var(--border-color);
    max-width: 100%;
}
.section h2 {
    font-size: 2.2rem;
    margin-bottom: 20px;
    color: var(--primary-color);
    border-bottom: 3px solid var(--primary-color);
    padding-bottom: 10px;
}
.concept-card {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 12px;
    border: 2px solid var(--border-color);
    margin: 20px 0;
    box-shadow: var(--shadow);
}
.concept-card h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.4rem;
}
.mermaid { margin: 30px 0; text-align: center; }
.example-box {
    background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
    border-left: 5px solid var(--primary-color);
    padding: 20px 25px;
    margin: 20px 0;
    border-radius: 8px;
}
.example-box strong {
    color: var(--primary-color);
    display: block;
    margin-bottom: 10px;
    font-size: 1.1rem;
}
footer {
    text-align: center;
    padding: 40px;
    background: #90CAF9;
    border-top: 2px solid var(--border-color);
    color: var(--text-color);
}
@media (max-width: 768px) {
    header h1 { font-size: 2rem; }
    
    .nav-menu {
        width: 100%;
        min-width: 100%;
        height: auto;
        position: relative;
        flex-direction: row;
        flex-wrap: wrap;
        padding: 10px;
        border-right: none;
        border-bottom: 2px solid var(--border-color);
    }
    .nav-link {
        padding: 8px 15px;
        margin: 4px;
    }
    
    .section { padding: 25px 20px; }
}
    .section {
    padding: 40px;
    min-height: calc(100vh - 200px);
    border-bottom: 1px solid var(--border-color);
    max-width: 100%;
}
    </style>
</head>
<body>
    <header>
        <h1>44. InfiniBand Subnet Manager</h1>
        <p class="subtitle">The Network Navigator for InfiniBand Infrastructure</p>
        <p class="author-credit">Explained by Naman Adep</p>
    </header>

    <div class="sidebar-wrapper">
    <nav class="nav-menu">
        <a href="#overview" class="nav-link active">Overview</a>
        <a href="#functions" class="nav-link">Functions</a>
        <a href="#lid-gid" class="nav-link">LID/GID Assignment</a>
        <a href="#routing" class="nav-link">Routing</a>
        <a href="#ha" class="nav-link">High Availability</a>
    </nav>
    <div class="main-content-wrapper">
        <main>
        <section id="overview" class="section">
            <h2>Subnet Manager Overview</h2>
            <p>
                The InfiniBand Subnet Manager (SM) is a critical component that discovers, configures, and manages 
                the InfiniBand fabric. It acts as the "navigator" of the network, assigning addresses, building routing 
                tables, and ensuring all devices can communicate efficiently. Without a Subnet Manager, an InfiniBand 
                network cannot function - it's responsible for bringing the fabric up and maintaining its operational 
                state. The SM runs on a designated node or switch and performs essential network initialization and 
                management tasks.
            </p>

            <div class="mermaid">
                graph TD
                    A[Subnet Manager] --> B[Discover Devices]
                    A --> C[Assign Addresses]
                    A --> D[Build Routing Tables]
                    A --> E[Configure Switches]
                    A --> F[Monitor Fabric]
                    
                    B --> B1[Find All Nodes]
                    B --> B2[Find All Switches]
                    
                    C --> C1[Assign LIDs]
                    C --> C2[Assign GIDs]
                    
                    D --> D1[Calculate Routes]
                    D --> D2[Distribute Tables]
                    
                    style A fill:#1976D2
                    style B fill:#2196F3
                    style C fill:#64B5F6
                    style D fill:#90CAF9
            </div>

            <div class="example-box">
                <strong>Subnet Manager Function:</strong>
                The Subnet Manager functions as the central management entity for InfiniBand networks. It discovers 
                network topology, assigns addresses (LIDs/GIDs), builds routing tables, and ensures all devices can 
                communicate efficiently. Without the Subnet Manager, InfiniBand devices cannot coordinate or communicate 
                - the network remains uninitialized and non-functional.
            </div>

            <div class="mermaid">
                mindmap
                  root((Subnet Manager))
                    Functions
                      Fabric Discovery
                      Address Assignment
                      Routing Table Building
                      Switch Configuration
                    Address Types
                      LID
                        Local Identifier
                        Subnet Routing
                      GID
                        Global Identifier
                        Inter-Subnet Routing
                    High Availability
                      Primary SM
                      Standby SM
                      Failover
                    Management
                      Topology Discovery
                      Performance Monitoring
                      Error Detection
            </div>
        </section>

        <section id="functions" class="section">
            <h2>Subnet Manager Functions</h2>
            <p>
                The Subnet Manager performs several critical functions that enable InfiniBand network operation. 
                These functions occur during fabric initialization and continue throughout network operation.
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
                <div class="concept-card" style="border-left: 5px solid #1976D2;">
                    <h3 style="color: #1976D2; margin-bottom: 15px;">Fabric Discovery</h3>
                    <p><strong>Function:</strong> Network topology</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        Discovers all nodes, switches, links, and device capabilities.
                    </p>
                </div>

                <div class="concept-card" style="border-left: 5px solid #2196F3;">
                    <h3 style="color: #2196F3; margin-bottom: 15px;">Address Assignment</h3>
                    <p><strong>Function:</strong> Device addressing</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        Assigns LIDs and GIDs to all devices for routing.
                    </p>
                </div>

                <div class="concept-card" style="border-left: 5px solid #64B5F6;">
                    <h3 style="color: #64B5F6; margin-bottom: 15px;">Routing & Configuration</h3>
                    <p><strong>Function:</strong> Network setup</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        Builds routing tables and configures switches.
                    </p>
                </div>
            </div>

            <div class="mermaid">
                sequenceDiagram
                    participant SM as Subnet Manager
                    participant Switch1
                    participant Switch2
                    participant Node1
                    participant Node2
                    
                    SM->>Switch1: Discover Topology
                    Switch1-->>SM: Switch Info + Links
                    SM->>Switch2: Discover Topology
                    Switch2-->>SM: Switch Info + Links
                    SM->>Node1: Discover Node
                    Node1-->>SM: Node Capabilities
                    SM->>Node2: Discover Node
                    Node2-->>SM: Node Capabilities
                    SM->>SM: Build Topology Map
                    SM->>SM: Assign LIDs/GIDs
                    SM->>SM: Build Routing Tables
                    Note over SM: Network Initialized<br/>Ready for Communication
            </div>

            <div class="mermaid">
                flowchart TD
                    A[Fabric Discovery] --> B[Topology Discovery<br/>Nodes, Switches, Links]
                    A --> C[Device Enumeration<br/>All IB Devices]
                    A --> D[Link Status<br/>Active Links]
                    A --> E[Capability Discovery<br/>Device Capabilities]
                    
                    B --> F[Complete Discovery<br/>Network Map]
                    C --> F
                    D --> F
                    E --> F
                    
                    style A fill:#1976D2
                    style F fill:#2196F3
                </div>

            <div class="mermaid">
                flowchart TD
                    A[Address Assignment] --> B[LID Assignment<br/>Local Identifiers]
                    A --> C[GID Assignment<br/>Global Identifiers]
                    A --> D[Port Configuration<br/>Port Addresses]
                    A --> E[Address Management<br/>Space Allocation]
                    
                    B --> F[Complete Addressing<br/>Network Ready]
                    C --> F
                    D --> F
                    E --> F
                    
                    style A fill:#1976D2
                    style F fill:#2196F3
                </div>

            <div class="mermaid">
                flowchart TD
                    A[Routing Table Generation] --> B[Path Calculation<br/>Optimal Paths]
                    A --> C[Route Distribution<br/>To Switches]
                    A --> D[Load Balancing<br/>Multiple Paths]
                    A --> E[Route Optimization<br/>Performance Tuning]
                    
                    B --> F[Complete Routing<br/>Network Operational]
                    C --> F
                    D --> F
                    E --> F
                    
                    style A fill:#1976D2
                    style F fill:#2196F3
                </div>

            <div class="mermaid">
                flowchart TD
                    A[Fabric Management] --> B[Switch Configuration<br/>Switch Parameters]
                    A --> C[Link Configuration<br/>Speeds & Widths]
                    A --> D[Performance Tuning<br/>Optimize Fabric]
                    A --> E[Error Handling<br/>Detect & Handle]
                    
                    B --> F[Complete Management<br/>Network Optimized]
                    C --> F
                    D --> F
                    E --> F
                    
                    style A fill:#1976D2
                    style F fill:#2196F3
                </div>
        </section>

        <section id="lid-gid" class="section">
            <h2>LID and GID Assignment</h2>
            <p>
                The Subnet Manager assigns two types of addresses to InfiniBand devices: Local Identifiers (LIDs) 
                and Global Identifiers (GIDs). These addresses enable routing and communication within the InfiniBand fabric.
            </p>

            <div class="concept-card">
                <h3>Local Identifier (LID)</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Purpose:</strong> Local routing within subnet</li>
                    <li><strong>Range:</strong> 16-bit value (1-49151)</li>
                    <li><strong>Assignment:</strong> Assigned by Subnet Manager</li>
                    <li><strong>Scope:</strong> Valid only within single subnet</li>
                    <li><strong>Usage:</strong> Used for local routing decisions</li>
                </ul>
            </div>

            <div class="mermaid">
                flowchart TD
                    A[Global Identifier GID] --> B[Purpose<br/>Global Routing]
                    A --> C[Format<br/>128-bit IPv6-like]
                    A --> D[Components<br/>Subnet Prefix + Suffix]
                    A --> E[Scope<br/>Globally Unique]
                    A --> F[Usage<br/>Inter-Subnet Routing]
                    
                    style A fill:#1976D2
                    style B fill:#2196F3
                </div>

            <div class="mermaid">
                flowchart TD
                    A[Address Assignment] --> B[Discovery<br/>Find All Devices]
                    B --> C[LID Assignment<br/>Sequential Assignment]
                    C --> D[GID Generation<br/>From Subnet Prefix]
                    D --> E[Distribution<br/>To Devices]
                    E --> F[Verification<br/>Uniqueness Check]
                    
                    style A fill:#1976D2
                    style F fill:#2196F3
                </div>

            <div class="example-box">
                <strong>Address Hierarchy:</strong>
                LIDs (Local Identifiers) are used for routing within a local InfiniBand subnet, while GIDs (Global 
                Identifiers) enable communication across different InfiniBand subnets. LIDs provide efficient local 
                routing, while GIDs provide global addressing for inter-subnet communication.
            </div>
        </section>

        <section id="routing" class="section">
            <h2>Routing Table Management</h2>
            <p>
                The Subnet Manager calculates and distributes routing tables that enable switches to forward packets 
                efficiently through the InfiniBand fabric. These routing tables determine the path packets take from 
                source to destination.
            </p>

            <div class="mermaid">
                graph LR
                    A[Subnet Manager] --> B[Calculate Routes]
                    B --> C[Build Routing Tables]
                    C --> D[Distribute to Switches]
                    D --> E[Switch 1]
                    D --> F[Switch 2]
                    D --> G[Switch 3]
                    
                    E --> H[Forward Packets]
                    F --> H
                    G --> H
                    
                    style A fill:#1976D2
                    style B fill:#2196F3
                    style C fill:#64B5F6
                    style D fill:#90CAF9
            </div>

            <div class="concept-card">
                <h3>Routing Algorithm</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Topology Analysis:</strong> Analyzes fabric topology</li>
                    <li><strong>Path Calculation:</strong> Calculates shortest paths</li>
                    <li><strong>Load Balancing:</strong> Distributes traffic across paths</li>
                    <li><strong>Route Optimization:</strong> Optimizes for performance</li>
                </ul>
            </div>

            <div class="concept-card">
                <h3>Routing Table Structure</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Destination LID:</strong> Target device LID</li>
                    <li><strong>Output Port:</strong> Port to forward packet</li>
                    <li><strong>Path Selection:</strong> Which path to use</li>
                    <li><strong>Load Balancing:</strong> Multiple paths for same destination</li>
                </ul>
            </div>

            <div class="concept-card">
                <h3>Dynamic Updates</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Topology Changes:</strong> Recalculates on topology changes</li>
                    <li><strong>Link Failures:</strong> Updates routes when links fail</li>
                    <li><strong>New Devices:</strong> Adds routes for new devices</li>
                    <li><strong>Performance Optimization:</strong> Adjusts routes for performance</li>
                </ul>
            </div>
        </section>

        <section id="ha" class="section">
            <h2>High Availability</h2>
            <p>
                InfiniBand networks require high availability for Subnet Manager functionality. Since the network 
                cannot operate without a Subnet Manager, redundancy and failover mechanisms are essential for 
                production deployments.
            </p>

            <div class="concept-card">
                <h3>Master and Standby SMs</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Master SM:</strong> Active Subnet Manager managing fabric</li>
                    <li><strong>Standby SM:</strong> Backup SM ready to take over</li>
                    <li><strong>Election:</strong> SMs elect master based on priority</li>
                    <li><strong>Failover:</strong> Standby takes over if master fails</li>
                </ul>
            </div>

            <div class="concept-card">
                <h3>SM Priority</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Priority Value:</strong> Numeric priority (0-15)</li>
                    <li><strong>Higher Priority:</strong> Higher priority becomes master</li>
                    <li><strong>Configuration:</strong> Set via SM configuration</li>
                    <li><strong>Best Practice:</strong> Set different priorities for redundancy</li>
                </ul>
            </div>

            <div class="concept-card">
                <h3>Failover Process</h3>
                <ol style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Detection:</strong> Standby detects master failure</li>
                    <li><strong>Election:</strong> Standby becomes new master</li>
                    <li><strong>Fabric Discovery:</strong> New master discovers fabric</li>
                    <li><strong>Reconfiguration:</strong> Reconfigures fabric if needed</li>
                    <li><strong>Resume Operation:</strong> Fabric resumes normal operation</li>
                </ol>
            </div>

            <div class="concept-card">
                <h3>Best Practices</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Multiple SMs:</strong> Deploy at least 2-3 SMs</li>
                    <li><strong>Different Nodes:</strong> Run SMs on different nodes</li>
                    <li><strong>Priority Configuration:</strong> Set appropriate priorities</li>
                    <li><strong>Monitoring:</strong> Monitor SM health and status</li>
                    <li><strong>Testing:</strong> Test failover scenarios regularly</li>
                </ul>
            </div>

            <div class="example-box">
                <strong>Production Recommendation:</strong>
                For production InfiniBand deployments, configure at least two Subnet Managers with different priorities. 
                Run them on different nodes to avoid single points of failure. Monitor SM status and test failover 
                scenarios to ensure reliable operation. This ensures network availability even if one SM fails.
            </div>
        </section>
            </main>

            </div>
</div>

    <footer>
        <p>InfiniBand Subnet Manager Guide | Network Navigator</p>
    </footer>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth' }
);
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                }

            });
        });

        const sections = document.querySelectorAll('.section');
        const navLinks = document.querySelectorAll('.nav-link');
        
        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }

            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
