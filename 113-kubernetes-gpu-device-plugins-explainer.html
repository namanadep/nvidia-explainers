<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>113. Kubernetes GPU Device Plugins: GPU Resource Management in Kubernetes</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
    --primary-color: #1976D2;
    --secondary-color: #1E88E5;
    --accent-color: #42A5F5;
    --bg-color: #E3F2FD;
    --card-bg: #FFFFFF;
    --text-color: #1A1A1A;
    --border-color: #90CAF9;
    --shadow: 0 2px 8px rgba(25, 118, 210, 0.1);
}
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    line-height: 1.6;
}
header {
    text-align: center;
    padding: 50px 40px;
    background: linear-gradient(135deg, #1976D2, #1E88E5);
    color: white;
    position: relative;
}
header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 12px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}
.subtitle {
    font-size: 1.2rem;
    opacity: 0.95;
    font-weight: 300;
}
.author-credit {
    font-size: 1rem;
    font-weight: 600;
    margin-top: 15px;
    padding: 8px 20px;
    background: rgba(255, 255, 255, 0.25);
    border-radius: 6px;
    display: inline-block;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    border: 2px solid rgba(255, 255, 255, 0.4);
}

.sidebar-wrapper {
    display: flex;
    min-height: calc(100vh - 200px);
}
.nav-menu {
    width: 280px;
    min-width: 280px;
    background: #80DEEA;
    border-right: 2px solid var(--border-color);
    padding: 20px 0;
    position: sticky;
    top: 0;
    height: calc(100vh - 200px);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.nav-link {
    color: var(--text-color);
    text-decoration: none;
    padding: 12px 20px;
    margin: 0 10px;
    border-radius: 6px;
    transition: all 0.2s ease;
    font-weight: 500;
    display: block;
}
.nav-link:hover, .nav-link.active {
    background: var(--primary-color);
    color: white;
}
.main-content-wrapper {
    flex: 1;
    width: calc(100% - 280px);
    min-width: 0;
}

.section {
    padding: 40px;
    min-height: calc(100vh - 200px);
    border-bottom: 1px solid var(--border-color);
    max-width: 100%;
}
.section h2 {
    font-size: 2.2rem;
    margin-bottom: 20px;
    color: var(--primary-color);
    border-bottom: 3px solid var(--primary-color);
    padding-bottom: 10px;
}
.section h3 {
    font-size: 1.6rem;
    margin: 25px 0 15px;
    color: var(--secondary-color);
}
.section p {
    margin-bottom: 18px;
    font-size: 1.05rem;
    line-height: 1.8;
}
.plugin-card {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 12px;
    border-left: 5px solid var(--primary-color);
    margin: 20px 0;
    box-shadow: var(--shadow);
}
.plugin-card h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.4rem;
}
.concept-card {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 12px;
    border: 2px solid var(--border-color);
    margin: 20px 0;
    box-shadow: var(--shadow);
}
.concept-card h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.4rem;
}
.mermaid { margin: 30px 0; text-align: center; }
.example-box {
    background: linear-gradient(135deg, #E3F2FD, #90CAF9);
    border-left: 5px solid var(--primary-color);
    padding: 20px 25px;
    margin: 20px 0;
    border-radius: 8px;
}
.example-box strong {
    color: var(--primary-color);
    display: block;
    margin-bottom: 10px;
    font-size: 1.1rem;
}
code {
    background: #F5F5F5;
    padding: 2px 8px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    color: #D32F2F;
}
.command-box {
    background: #263238;
    color: #42A5F5;
    padding: 20px;
    border-radius: 8px;
    margin: 15px 0;
    font-family: 'Courier New', monospace;
    overflow-x: auto;
}
footer {
    text-align: center;
    padding: 40px;
    background: #90CAF9;
    border-top: 2px solid var(--border-color);
    color: var(--text-color);
}
@media (max-width: 768px) {
    header h1 { font-size: 2rem; }
    
    .nav-menu {
        width: 100%;
        min-width: 100%;
        height: auto;
        position: relative;
        flex-direction: row;
        flex-wrap: wrap;
        padding: 10px;
        border-right: none;
        border-bottom: 2px solid var(--border-color);
    }
    .nav-link {
        padding: 8px 15px;
        margin: 4px;
    }
    
    .section { padding: 25px 20px; }
}
    .section {
    padding: 40px;
    min-height: calc(100vh - 200px);
    border-bottom: 1px solid var(--border-color);
    max-width: 100%;
}
    </style>
</head>
<body>
    <header>
        <h1>113. Kubernetes GPU Device Plugins</h1>
        <p class="subtitle">GPU Resource Management and Discovery in Kubernetes</p>
        <p class="author-credit">Explained by Naman Adep</p>
    </header>

    <div class="sidebar-wrapper">
    <nav class="nav-menu">
        <a href="#overview" class="nav-link active">Overview</a>
        <a href="#architecture" class="nav-link">Architecture</a>
        <a href="#nvidia-plugin" class="nav-link">NVIDIA Plugin</a>
        <a href="#deployment" class="nav-link">Deployment</a>
        <a href="#configuration" class="nav-link">Configuration</a>
        <a href="#troubleshooting" class="nav-link">Troubleshooting</a>
        <a href="#best-practices" class="nav-link">Best Practices</a>
    </nav>
    <div class="main-content-wrapper">
        <main>
        <section id="overview" class="section">
            <h2>Kubernetes GPU Device Plugins Overview</h2>
            <p>
                Kubernetes Device Plugins enable GPU resource management in Kubernetes clusters. Device plugins 
                advertise GPU resources to the kubelet, allowing pods to request and use GPUs. The NVIDIA Device 
                Plugin is the standard solution for exposing NVIDIA GPUs to Kubernetes workloads. Understanding 
                device plugins enables proper GPU resource allocation, scheduling, and management in Kubernetes 
                environments.
            </p>

            <div class="mermaid">
                graph TD
                    A[Kubernetes Cluster] --> B[kubelet]
                    B --> C[Device Plugin API]
                    C --> D[NVIDIA Device Plugin]
                    D --> E[GPU Discovery]
                    D --> F[GPU Allocation]
                    E --> G[Node Resources]
                    F --> H[Pod GPU Access]
                    G --> I[Scheduler]
                    I --> H
                    
                    style A fill:#1976D2
                    style D fill:#1E88E5
                    style H fill:#42A5F5
            </div>

            <div class="example-box">
                <strong>Device Plugin Impact:</strong>
                Device plugins enable Kubernetes to discover, advertise, and allocate GPU resources to pods. Without 
                device plugins, Kubernetes cannot recognize GPUs as schedulable resources. Proper device plugin 
                configuration ensures efficient GPU utilization and proper resource allocation.
            </div>

            <div class="mermaid">
                mindmap
                  root((GPU Device Plugins))
                    Architecture
                      Device Plugin API
                      kubelet Integration
                      Resource Discovery
                    NVIDIA Plugin
                      Installation
                      Configuration
                      GPU Types
                    Deployment
                      DaemonSet
                      Node Selection
                      Resource Limits
                    Configuration
                      GPU Sharing
                      MIG Support
                      Time-Slicing
                    Troubleshooting
                      Plugin Status
                      Resource Allocation
                      Log Analysis
            </div>
        </section>

        <section id="architecture" class="section">
            <h2>Device Plugin Architecture</h2>
            <p>
                Kubernetes Device Plugin architecture enables hardware resource management through a standardized 
                API. Device plugins communicate with kubelet to advertise and allocate resources.
            </p>

            <div class="concept-card">
                <h3>Device Plugin API</h3>
                <p>The Device Plugin API enables communication between device plugins and kubelet:</p>
                
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Registration:</strong> Device plugins register with kubelet via Unix socket</li>
                    <li><strong>Discovery:</strong> Plugins advertise available device resources</li>
                    <li><strong>Allocation:</strong> Plugins allocate devices when pods request them</li>
                    <li><strong>Health:</strong> Plugins report device health status</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Device Plugin Socket:</strong></p>
                <div class="command-box">
# Device plugin socket location
/var/lib/kubelet/device-plugins/kubelet.sock

# Device plugin registration
# Plugins register via gRPC on this socket
                </div>
            </div>

            <div class="concept-card">
                <h3>kubelet Integration</h3>
                <p>kubelet manages device plugins and resource allocation:</p>
                
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Plugin Discovery:</strong> kubelet discovers plugins via socket registration</li>
                    <li><strong>Resource Advertising:</strong> kubelet advertises device resources to API server</li>
                    <li><strong>Allocation:</strong> kubelet requests device allocation from plugins</li>
                    <li><strong>Health Monitoring:</strong> kubelet monitors plugin and device health</li>
                </ul>
            </div>

            <div class="mermaid">
                sequenceDiagram
                    participant Pod
                    participant Scheduler
                    participant kubelet
                    participant DevicePlugin
                    participant GPU

                    Pod->>Scheduler: Request GPU resource
                    Scheduler->>kubelet: Schedule pod to node
                    kubelet->>DevicePlugin: Allocate GPU
                    DevicePlugin->>GPU: Reserve GPU
                    DevicePlugin->>kubelet: Return device info
                    kubelet->>Pod: Mount GPU device
            </div>

            <div class="mermaid">
                flowchart TD
                    A[Device Plugin Starts] --> B[Discover GPUs]
                    B --> C[Register with kubelet]
                    C --> D[Advertise GPU Resources]
                    D --> E[Pod Requests GPU]
                    E --> F{Scheduler Finds Node}
                    F -->|No| G[Pod Pending]
                    G --> E
                    F -->|Yes| H[kubelet Requests Allocation]
                    H --> I{GPU Available?}
                    I -->|No| J[Allocation Failed]
                    J --> E
                    I -->|Yes| K[Device Plugin Allocates]
                    K --> L[GPU Reserved]
                    L --> M[Pod Starts]
                    M --> N[Pod Uses GPU]
                    N --> O{Pod Terminates?}
                    O -->|No| N
                    O -->|Yes| P[Release GPU]
                    P --> D
                    
                    style A fill:#1976D2
                    style M fill:#4CAF50
                    style F fill:#FF9800
                    style I fill:#FF9800
                    style O fill:#FF9800
            </div>
        </section>

        <section id="nvidia-plugin" class="section">
            <h2>NVIDIA Device Plugin</h2>
            <p>
                The NVIDIA Device Plugin is the standard solution for exposing NVIDIA GPUs to Kubernetes. It 
                discovers GPUs, advertises them as resources, and manages GPU allocation to pods.
            </p>

            <div class="plugin-card">
                <h3>NVIDIA Device Plugin Features</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>GPU Discovery:</strong> Automatically discovers all NVIDIA GPUs on nodes</li>
                    <li><strong>Resource Advertising:</strong> Advertises GPUs as <code>nvidia.com/gpu</code> resources</li>
                    <li><strong>MIG Support:</strong> Supports Multi-Instance GPU (MIG) devices</li>
                    <li><strong>Time-Slicing:</strong> Supports GPU time-slicing for sharing</li>
                    <li><strong>Health Monitoring:</strong> Monitors GPU health and reports failures</li>
                </ul>
            </div>

            <div class="plugin-card">
                <h3>Resource Naming</h3>
                <p>NVIDIA Device Plugin advertises GPUs with specific resource names:</p>
                
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Standard GPU:</strong> <code>nvidia.com/gpu</code> - Full GPU</li>
                    <li><strong>MIG Device:</strong> <code>nvidia.com/mig-{profile}</code> - MIG instance</li>
                    <li><strong>Time-Sliced:</strong> <code>nvidia.com/gpu</code> - Shared GPU (time-slicing)</li>
                </ul>
            </div>
        </section>

        <section id="deployment" class="section">
            <h2>Deploying NVIDIA Device Plugin</h2>
            <p>
                Deploy NVIDIA Device Plugin as a DaemonSet to ensure it runs on all GPU nodes. Proper deployment 
                ensures GPU resources are available to Kubernetes workloads.
            </p>

            <div class="concept-card">
                <h3>DaemonSet Deployment</h3>
                <p>Deploy NVIDIA Device Plugin using DaemonSet:</p>
                
                <p style="margin-top: 20px;"><strong>Deploy via Helm:</strong></p>
                <div class="command-box">
# Add NVIDIA Helm repository
helm repo add nvdp https://nvidia.github.io/k8s-device-plugin
helm repo update

# Install NVIDIA Device Plugin
helm install nvidia-device-plugin \
    nvdp/nvidia-device-plugin \
    --namespace kube-system \
    --set version=v0.14.0
                </div>

                <p style="margin-top: 20px;"><strong>Deploy via kubectl:</strong></p>
                <div class="command-box">
# Apply NVIDIA Device Plugin manifest
kubectl apply -f https://raw.githubusercontent.com/NVIDIA/k8s-device-plugin/v0.14.0/nvidia-device-plugin.yml
                </div>
            </div>

            <div class="concept-card">
                <h3>DaemonSet Configuration</h3>
                <p>Example DaemonSet configuration:</p>
                
                <p style="margin-top: 20px;"><strong>Basic DaemonSet YAML:</strong></p>
                <div class="command-box">
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: nvidia-device-plugin-daemonset
  namespace: kube-system
spec:
  selector:
    matchLabels:
      name: nvidia-device-plugin-ds
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        name: nvidia-device-plugin-ds
    spec:
      tolerations:
      - key: nvidia.com/gpu
        operator: Exists
        effect: NoSchedule
      containers:
      - image: nvcr.io/nvidia/k8s-device-plugin:v0.14.0
        name: nvidia-device-plugin-ctr
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop: ["ALL"]
        volumeMounts:
        - name: device-plugin
          mountPath: /var/lib/kubelet/device-plugins
      volumes:
      - name: device-plugin
        hostPath:
          path: /var/lib/kubelet/device-plugins
                </div>
            </div>

            <div class="concept-card">
                <h3>Node Selection</h3>
                <p>Configure node selection for GPU nodes:</p>
                
                <p style="margin-top: 20px;"><strong>Node Selector:</strong></p>
                <div class="command-box">
# Add node selector to DaemonSet
spec:
  template:
    spec:
      nodeSelector:
        accelerator: nvidia-tesla-v100
        # or
        nvidia.com/gpu.present: "true"
                </div>

                <p style="margin-top: 20px;"><strong>Label GPU Nodes:</strong></p>
                <div class="command-box">
# Label nodes with GPUs
kubectl label nodes [node-name] accelerator=nvidia-tesla-v100
kubectl label nodes [node-name] nvidia.com/gpu.present=true
                </div>
            </div>
        </section>

        <section id="configuration" class="section">
            <h2>Device Plugin Configuration</h2>
            <p>
                Configure NVIDIA Device Plugin for specific requirements including MIG support, time-slicing, and 
                GPU sharing strategies.
            </p>

            <div class="plugin-card">
                <h3>MIG Configuration</h3>
                <p>Configure device plugin for MIG support:</p>
                
                <p style="margin-top: 20px;"><strong>MIG-Enabled Configuration:</strong></p>
                <div class="command-box">
# Configure device plugin for MIG
apiVersion: v1
kind: ConfigMap
metadata:
  name: device-plugin-config
  namespace: kube-system
data:
  config.yaml: |
    version: v1
    sharing:
      timeSlicing:
        resources:
        - name: nvidia.com/gpu
          replicas: 4
    migStrategy: "mixed"
                </div>
            </div>

            <div class="plugin-card">
                <h3>Time-Slicing Configuration</h3>
                <p>Configure GPU time-slicing for sharing:</p>
                
                <p style="margin-top: 20px;"><strong>Time-Slicing ConfigMap:</strong></p>
                <div class="command-box">
# Enable time-slicing for GPU sharing
apiVersion: v1
kind: ConfigMap
metadata:
  name: device-plugin-config
  namespace: kube-system
data:
  config.yaml: |
    version: v1
    sharing:
      timeSlicing:
        resources:
        - name: nvidia.com/gpu
          replicas: 4
                </div>

                <p style="margin-top: 20px;"><strong>Deploy with ConfigMap:</strong></p>
                <div class="command-box">
# Reference ConfigMap in DaemonSet
spec:
  template:
    spec:
      containers:
      - name: nvidia-device-plugin-ctr
        env:
        - name: CONFIG_FILE
          value: /etc/nvidia/config.yaml
        volumeMounts:
        - name: device-plugin-config
          mountPath: /etc/nvidia
      volumes:
      - name: device-plugin-config
        configMap:
          name: device-plugin-config
                </div>
            </div>
        </section>

        <section id="troubleshooting" class="section">
            <h2>Troubleshooting Device Plugins</h2>
            <p>
                Troubleshoot device plugin issues by checking plugin status, resource allocation, and logs. Common 
                issues include plugin not running, GPUs not advertised, and allocation failures.
            </p>

            <div class="concept-card">
                <h3>Check Plugin Status</h3>
                <p>Verify device plugin is running:</p>
                
                <p style="margin-top: 20px;"><strong>Check DaemonSet Status:</strong></p>
                <div class="command-box">
# Check DaemonSet status
kubectl get daemonset -n kube-system nvidia-device-plugin-daemonset

# Check pod status
kubectl get pods -n kube-system -l name=nvidia-device-plugin-ds

# Describe pod for details
kubectl describe pod -n kube-system [pod-name]
                </div>

                <p style="margin-top: 20px;"><strong>Check Plugin Logs:</strong></p>
                <div class="command-box">
# View device plugin logs
kubectl logs -n kube-system [pod-name] -f

# Check for errors
kubectl logs -n kube-system [pod-name] | grep -i error
                </div>
            </div>

            <div class="concept-card">
                <h3>Check GPU Resources</h3>
                <p>Verify GPUs are advertised as resources:</p>
                
                <p style="margin-top: 20px;"><strong>Check Node Resources:</strong></p>
                <div class="command-box">
# Check node capacity and allocatable
kubectl describe node [node-name] | grep -A 5 "Capacity:"
kubectl describe node [node-name] | grep -A 5 "Allocatable:"

# Check for nvidia.com/gpu resource
kubectl describe node [node-name] | grep nvidia.com/gpu
                </div>

                <p style="margin-top: 20px;"><strong>Check GPU Allocation:</strong></p>
                <div class="command-box">
# Check pods using GPUs
kubectl get pods --all-namespaces -o json | \
    jq '.items[] | select(.spec.containers[].resources.requests."nvidia.com/gpu")'

# Check GPU usage
kubectl top node [node-name]
                </div>
            </div>
        </section>

        <section id="best-practices" class="section">
            <h2>Best Practices</h2>
            <p>
                Follow best practices for device plugin deployment and configuration to ensure reliable GPU 
                resource management.
            </p>

            <div class="concept-card">
                <h3>Deployment Best Practices</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li>Deploy device plugin as DaemonSet on all GPU nodes</li>
                    <li>Use node selectors to target GPU nodes only</li>
                    <li>Set appropriate resource limits for plugin pods</li>
                    <li>Monitor plugin health and restart on failure</li>
                    <li>Keep device plugin version updated</li>
                </ul>
            </div>

            <div class="concept-card">
                <h3>Configuration Best Practices</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li>Configure MIG support if using MIG-enabled GPUs</li>
                    <li>Use time-slicing for GPU sharing when appropriate</li>
                    <li>Set proper resource requests and limits in pods</li>
                    <li>Monitor GPU utilization and allocation</li>
                    <li>Document device plugin configuration</li>
                </ul>
            </div>

            <div class="example-box">
                <strong>Device Plugin Checklist:</strong>
                1. Verify NVIDIA drivers installed on nodes<br>
                2. Deploy NVIDIA Device Plugin DaemonSet<br>
                3. Verify plugin pods are running<br>
                4. Check GPUs are advertised as resources<br>
                5. Test GPU allocation in pods<br>
                6. Configure MIG or time-slicing if needed<br>
                7. Monitor plugin health and logs<br>
                8. Set up alerts for plugin failures
            </div>
        </section>
            </main>

            </div>
</div>

    <footer>
        <p>Kubernetes GPU Device Plugins | GPU Resource Management in Kubernetes</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);
                
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' }
);
            });
        });

        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav-link');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (window.pageYOffset >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }

            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
