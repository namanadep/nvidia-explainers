<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>127. InfiniBand Performance Optimization: Optimizing InfiniBand Network Performance</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
    --primary-color: #0277BD;
    --secondary-color: #0288D1;
    --accent-color: #039BE5;
    --bg-color: #E1F5FE;
    --card-bg: #FFFFFF;
    --text-color: #1A1A1A;
    --border-color: #81D4FA;
    --shadow: 0 2px 8px rgba(2, 119, 189, 0.1);
}
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    line-height: 1.6;
}
header {
    text-align: center;
    padding: 50px 40px;
    background: linear-gradient(135deg, #0277BD, #0288D1);
    color: white;
    position: relative;
}
header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 12px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}
.subtitle {
    font-size: 1.2rem;
    opacity: 0.95;
    font-weight: 300;
}
.author-credit {
    font-size: 1rem;
    font-weight: 600;
    margin-top: 15px;
    padding: 8px 20px;
    background: rgba(255, 255, 255, 0.25);
    border-radius: 6px;
    display: inline-block;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    border: 2px solid rgba(255, 255, 255, 0.4);
}

.sidebar-wrapper {
    display: flex;
    min-height: calc(100vh - 200px);
}
.nav-menu {
    width: 280px;
    min-width: 280px;
    background: #80DEEA;
    border-right: 2px solid var(--border-color);
    padding: 20px 0;
    position: sticky;
    top: 0;
    height: calc(100vh - 200px);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.nav-link {
    color: var(--text-color);
    text-decoration: none;
    padding: 12px 20px;
    margin: 0 10px;
    border-radius: 6px;
    transition: all 0.2s ease;
    font-weight: 500;
    display: block;
}
.nav-link:hover, .nav-link.active {
    background: var(--primary-color);
    color: white;
}
.main-content-wrapper {
    flex: 1;
    width: calc(100% - 280px);
    min-width: 0;
}

.section {
    padding: 40px;
    min-height: calc(100vh - 200px);
    border-bottom: 1px solid var(--border-color);
    max-width: 100%;
}
.section h2 {
    font-size: 2.2rem;
    margin-bottom: 20px;
    color: var(--primary-color);
    border-bottom: 3px solid var(--primary-color);
    padding-bottom: 10px;
}
.section h3 {
    font-size: 1.6rem;
    margin: 25px 0 15px;
    color: var(--secondary-color);
}
.section p {
    margin-bottom: 18px;
    font-size: 1.05rem;
    line-height: 1.8;
}
.optimization-card {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 12px;
    border-left: 5px solid var(--primary-color);
    margin: 20px 0;
    box-shadow: var(--shadow);
}
.optimization-card h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.4rem;
}
.concept-card {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 12px;
    border: 2px solid var(--border-color);
    margin: 20px 0;
    box-shadow: var(--shadow);
}
.concept-card h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.4rem;
}
.mermaid { margin: 30px 0; text-align: center; }
.example-box {
    background: linear-gradient(135deg, #E1F5FE, #81D4FA);
    border-left: 5px solid var(--primary-color);
    padding: 20px 25px;
    margin: 20px 0;
    border-radius: 8px;
}
.example-box strong {
    color: var(--primary-color);
    display: block;
    margin-bottom: 10px;
    font-size: 1.1rem;
}
code {
    background: #F5F5F5;
    padding: 2px 8px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    color: #D32F2F;
}
.command-box {
    background: #263238;
    color: #039BE5;
    padding: 20px;
    border-radius: 8px;
    margin: 15px 0;
    font-family: 'Courier New', monospace;
    overflow-x: auto;
}
footer {
    text-align: center;
    padding: 40px;
    background: #81D4FA;
    border-top: 2px solid var(--border-color);
    color: var(--text-color);
}
@media (max-width: 768px) {
    header h1 { font-size: 2rem; }
    
    .nav-menu {
        width: 100%;
        min-width: 100%;
        height: auto;
        position: relative;
        flex-direction: row;
        flex-wrap: wrap;
        padding: 10px;
        border-right: none;
        border-bottom: 2px solid var(--border-color);
    }
    .nav-link {
        padding: 8px 15px;
        margin: 4px;
    }
    
    .section { padding: 25px 20px; }
}
    .section {
    padding: 40px;
    min-height: calc(100vh - 200px);
    border-bottom: 1px solid var(--border-color);
    max-width: 100%;
}
    </style>
</head>
<body>
    <header>
        <h1>127. InfiniBand Performance Optimization</h1>
        <p class="subtitle">Optimizing InfiniBand Network Performance</p>
        <p class="author-credit">Explained by Naman Adep</p>
    </header>

    <div class="sidebar-wrapper">
    <nav class="nav-menu">
        <a href="#overview" class="nav-link active">Overview</a>
        <a href="#fabric-tuning" class="nav-link">Fabric Tuning</a>
        <a href="#link-optimization" class="nav-link">Link Optimization</a>
        <a href="#routing-optimization" class="nav-link">Routing</a>
        <a href="#monitoring" class="nav-link">Performance Monitoring</a>
        <a href="#best-practices" class="nav-link">Best Practices</a>
    </nav>
    <div class="main-content-wrapper">
        <main>
        <section id="overview" class="section">
            <h2>InfiniBand Performance Optimization Overview</h2>
            <p>
                InfiniBand performance optimization improves network throughput, reduces latency, and maximizes 
                bandwidth utilization. Optimization includes fabric tuning, link optimization, routing optimization, 
                and performance monitoring. Effective optimization ensures optimal performance for AI workloads. 
                Understanding performance optimization enables tuning of InfiniBand networks for maximum efficiency.
            </p>

            <div class="mermaid">
                graph TD
                    A[InfiniBand Optimization] --> B[Fabric Tuning]
                    A --> C[Link Optimization]
                    A --> D[Routing Optimization]
                    A --> E[Performance Monitoring]
                    B --> F[Subnet Manager Tuning]
                    B --> G[Switch Configuration]
                    C --> H[Link Speed]
                    C --> I[Link Width]
                    D --> J[LID Assignment]
                    D --> K[Path Selection]
                    E --> L[Metrics Collection]
                    E --> M[Bottleneck Identification]
                    
                    style A fill:#0277BD
                    style B fill:#0288D1
                    style C fill:#039BE5
            </div>

            <div class="example-box">
                <strong>Optimization Impact:</strong>
                Effective InfiniBand optimization can improve bandwidth utilization by 20-40%, reduce latency by 
                10-30%, and improve overall application performance. Proper tuning ensures optimal performance for 
                AI workloads requiring high-bandwidth communication.
            </div>

            <div class="mermaid">
                mindmap
                  root((InfiniBand Optimization))
                    Fabric Tuning
                      Subnet Manager
                      Switch Configuration
                      Flow Control
                    Link Optimization
                      Link Speed
                      Link Width
                      Link Quality
                    Routing Optimization
                      LID Assignment
                      Path Selection
                      Routing Tables
                    Performance Monitoring
                      Metrics Collection
                      Bottleneck Identification
                      Performance Analysis
            </div>
        </section>

        <section id="fabric-tuning" class="section">
            <h2>Fabric Performance Tuning</h2>
            <p>
                Tune InfiniBand fabric for optimal performance. Fabric tuning includes subnet manager configuration, 
                switch settings, and flow control optimization.
            </p>

            <div class="optimization-card">
                <h3>Subnet Manager Tuning</h3>
                <p>Optimize subnet manager for performance:</p>
                
                <p style="margin-top: 20px;"><strong>Subnet Manager Configuration:</strong></p>
                <div class="command-box">
# Check subnet manager status
systemctl status opensm

# Configure subnet manager options
# Edit /etc/opensm/opensm.conf

# Key parameters:
# sm_priority: Subnet manager priority
# perfmgr: Performance manager
# routing_engine: Routing algorithm (minhop, updn, etc.)
                </div>

                <p style="margin-top: 20px;"><strong>Routing Engine Selection:</strong></p>
                <ul style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li><strong>minhop:</strong> Minimum hop count (default, good for most cases)</li>
                    <li><strong>updn:</strong> Up/down routing (good for fat-tree)</li>
                    <li><strong>ftree:</strong> Fat-tree routing (optimized for fat-tree)</li>
                    <li><strong>dnup:</strong> Down/up routing</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h3>Switch Configuration</h3>
                <p>Optimize switch settings for performance:</p>
                
                <p style="margin-top: 20px;"><strong>Switch Tuning Parameters:</strong></p>
                <ul style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li><strong>Flow Control:</strong> Enable credit-based flow control</li>
                    <li><strong>Adaptive Routing:</strong> Enable adaptive routing for load balancing</li>
                    <li><strong>SHARP:</strong> Enable SHARP for collective operations</li>
                    <li><strong>QoS:</strong> Configure QoS for traffic prioritization</li>
                </ul>
            </div>
        </section>

        <section id="link-optimization" class="section">
            <h2>Link Optimization</h2>
            <p>
                Optimize InfiniBand links for maximum bandwidth and reliability. Link optimization includes link 
                speed, width, and quality tuning.
            </p>

            <div class="concept-card">
                <h3>Link Speed Configuration</h3>
                <p>Configure link speed for optimal performance:</p>
                
                <p style="margin-top: 20px;"><strong>Check Link Speed:</strong></p>
                <div class="command-box">
# Check link speed and width
ibstat [device]

# Check link information
iblinkinfo

# Check link details
ibqueryerrors -r
                </div>

                <p style="margin-top: 20px;"><strong>Link Speed Options:</strong></p>
                <ul style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li><strong>SDR:</strong> Single Data Rate (2.5 Gbps per lane)</li>
                    <li><strong>DDR:</strong> Double Data Rate (5 Gbps per lane)</li>
                    <li><strong>QDR:</strong> Quad Data Rate (10 Gbps per lane)</li>
                    <li><strong>FDR:</strong> Fourteen Data Rate (14 Gbps per lane)</li>
                    <li><strong>EDR:</strong> Enhanced Data Rate (25 Gbps per lane)</li>
                    <li><strong>HDR:</strong> High Data Rate (50 Gbps per lane)</li>
                    <li><strong>NDR:</strong> Next Data Rate (100 Gbps per lane)</li>
                </ul>
            </div>

            <div class="concept-card">
                <h3>Link Width Optimization</h3>
                <p>Optimize link width for bandwidth:</p>
                
                <p style="margin-top: 20px;"><strong>Link Width Options:</strong></p>
                <ul style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li><strong>x1:</strong> 1 lane (minimal bandwidth)</li>
                    <li><strong>x4:</strong> 4 lanes (common for server connections)</li>
                    <li><strong>x12:</strong> 12 lanes (high bandwidth)</li>
                    <li><strong>x16:</strong> 16 lanes (maximum bandwidth)</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Bandwidth Calculation:</strong></p>
                <div class="command-box">
# Bandwidth = Link Speed × Link Width × Efficiency Factor
# Example: HDR x4
# 50 Gbps × 4 lanes × 0.97 efficiency = ~194 Gbps per direction
# Full duplex = ~388 Gbps total
                </div>
            </div>

            <div class="mermaid">
                flowchart TD
                    A[Link Optimization] --> B[Check Link Status]
                    B --> C{Link Speed OK?}
                    C -->|No| D[Configure Link Speed]
                    C -->|Yes| E{Link Width OK?}
                    D --> E
                    E -->|No| F[Configure Link Width]
                    E -->|Yes| G[Check Link Quality]
                    F --> G
                    G --> H{Errors?}
                    H -->|Yes| I[Fix Link Issues]
                    H -->|No| J[Link Optimized]
                    I --> B
                    
                    style A fill:#0277BD
                    style J fill:#4CAF50
                    style C fill:#FF9800
                    style E fill:#FF9800
                    style H fill:#FF9800
                </div>
        </section>

        <section id="routing-optimization" class="section">
            <h2>Routing Optimization</h2>
            <p>
                Optimize InfiniBand routing for optimal path selection and load balancing. Routing optimization 
                improves bandwidth utilization and reduces congestion.
            </p>

            <div class="optimization-card">
                <h3>LID Assignment Optimization</h3>
                <p>Optimize LID assignment for routing efficiency:</p>
                
                <p style="margin-top: 20px;"><strong>LID Assignment Best Practices:</strong></p>
                <ul style="margin-top: 10px; padding-left: 20px; line-height: 2;">
                    <li>Assign LIDs based on topology</li>
                    <li>Group nodes on same switch with consecutive LIDs</li>
                    <li>Optimize for routing algorithm</li>
                    <li>Consider switch placement</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h3>Path Selection Optimization</h3>
                <p>Optimize path selection for load balancing:</p>
                
                <p style="margin-top: 20px;"><strong>Enable Adaptive Routing:</strong></p>
                <div class="command-box">
# Adaptive routing distributes traffic across multiple paths
# Configured on switches (vendor-specific commands)

# Check routing
ibroute [device]

# View fabric paths
ibnetdiscover
                </div>
            </div>
        </section>

        <section id="monitoring" class="section">
            <h2>Performance Monitoring</h2>
            <p>
                Monitor InfiniBand performance to identify bottlenecks and validate optimizations. Performance 
                monitoring includes metrics collection and analysis.
            </p>

            <div class="concept-card">
                <h3>Performance Metrics</h3>
                <p>Monitor key InfiniBand performance metrics:</p>
                
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li><strong>Bandwidth:</strong> Actual bandwidth utilization</li>
                    <li><strong>Latency:</strong> End-to-end latency</li>
                    <li><strong>Errors:</strong> Link errors, packet drops</li>
                    <li><strong>Congestion:</strong> Congestion indicators</li>
                    <li><strong>Utilization:</strong> Port and switch utilization</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Performance Monitoring Commands:</strong></p>
                <div class="command-box">
# Monitor bandwidth
ibwrite_bw [options]
ibread_bw [options]

# Monitor latency
ibwrite_lat [options]
ibread_lat [options]

# Check errors
ibqueryerrors

# Monitor fabric performance
perfquery [device]
                </div>
            </div>

            <div class="concept-card">
                <h3>Bottleneck Identification</h3>
                <p>Identify performance bottlenecks:</p>
                
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li>Monitor port utilization</li>
                    <li>Check for link errors</li>
                    <li>Analyze routing paths</li>
                    <li>Identify congested links</li>
                    <li>Review switch statistics</li>
                </ul>
            </div>
        </section>

        <section id="best-practices" class="section">
            <h2>Performance Optimization Best Practices</h2>
            <p>
                Follow best practices for effective InfiniBand performance optimization.
            </p>

            <div class="concept-card">
                <h3>Optimization Best Practices</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 2;">
                    <li>Monitor performance before optimizing</li>
                    <li>Identify bottlenecks systematically</li>
                    <li>Optimize fabric configuration</li>
                    <li>Tune link settings</li>
                    <li>Optimize routing</li>
                    <li>Monitor after optimization</li>
                    <li>Validate improvements</li>
                </ul>
            </div>

            <div class="example-box">
                <strong>InfiniBand Optimization Checklist:</strong>
                1. Monitor baseline performance<br>
                2. Identify bottlenecks<br>
                3. Optimize subnet manager<br>
                4. Tune switch configuration<br>
                5. Optimize link settings<br>
                6. Optimize routing<br>
                7. Enable adaptive routing<br>
                8. Monitor optimized performance<br>
                9. Validate improvements<br>
                10. Document optimizations
            </div>
        </section>
            </main>

            </div>
</div>

    <footer>
        <p>InfiniBand Performance Optimization | Optimizing InfiniBand Network Performance</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);
                
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' }
);
            });
        });

        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav-link');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (window.pageYOffset >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }

            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
